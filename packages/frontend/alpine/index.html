<!doctype html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bulma@1.0.4/css/bulma.min.css"
    />
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>

    <title>Naruto Shippuuden</title>
  </head>
  <body>
    <main class="container mt-6">
      <div id="progress-wrapper" style="display: none">
        <h1 class="is-size-2">Status Naruto Shippuuden</h1>
        <h2 id="last-watched" class="is-size-3"></h2>
        <h3>
          W ciągu ostatniego tygodnia obejrzałem
          <span id="in-last-week"></span>
        </h3>
        <hr />
        <h3 class="pb-2">
          Obejrzałem już <span id="percent"></span> Naruto Shippuuden:
        </h3>
        <progress class="progress" id="progress" max="500"></progress>
        <hr />
        <h2 id="last-updated" class="is-size-6"></h2>
      </div>
    </main>
  </body>
  <script type="module">
    import {
      updateProgressBar,
      updateLastUpdatedEl,
      updateLastWatched,
      howManyEpisodesInLastSevenDays,
    } from '/js/manipulate-dom.js';
    import { fetchData, fetchEpisodeTitle } from '/js/fetch.js';

    const main = async () => {
      const result = await fetchData();

      const lastWatchedEpisode = result.items[0];
      const episodeTitle = await fetchEpisodeTitle(lastWatchedEpisode.title);

      updateLastWatched(result, episodeTitle);
      updateLastUpdatedEl(result);
      updateProgressBar(result);
      howManyEpisodesInLastSevenDays(result);
    };

    main();

    document.addEventListener('alpine:init', () => {
      Alpine.data('searchInput', () => ({
        hello: 'world',
      }));
    });
  </script>
</html>
